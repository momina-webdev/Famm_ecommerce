{% extends "base.html" %}
{% load static %}
<link rel="shortcut icon" href="{% static 'img/favicon.png' %}" type="">
{% block body %}
<link rel="stylesheet" href="{% static 'css/Account.css' %}">

<div class="account-container">
  <h2 class="account-title">My Account</h2>

  <div class="tab-buttons">
    <button class="tab-button active" data-target="profileTab">Profile</button>
    <button class="tab-button" data-target="ordersTab">Orders</button>
  </div>

  <!-- Profile Tab -->
  <div id="profileTab" class="tab-content active profile-info">
    <h5>Profile Information</h5>
    <p><strong>Name:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
  </div>

  <!-- Orders Tab -->
  <div id="ordersTab" class="tab-content">
    {% if orders %}
    <div class="accordion" id="ordersAccordion">
      {% for order in orders %}
      <div class="accordion-item" style="background: transparent; border:none;">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">
            Order #{{ order.id }} — {{ order.created_at|date:"M d, Y" }} — Items: {{ order.items.count }} — Status: <span style="font-weight:700;">{{ order.get_status_display }}</span>
          </button>
        </h2>
        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#ordersAccordion">
          <div class="accordion-body p-0">
            <table class="table table-hover align-middle mb-0">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Name</th>
                  <th>Size</th>
                  <th>Qty</th>
                  <th>Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {% for item in order.items.all %}
                <tr>
                  <td data-label="Product">
                    {% if item.image_url %}
                      <img src="{{ item.image_url }}" alt="{{ item.product_name }}">
                    {% else %}
                      <img src="{% static 'img/default-product.png' %}" alt="No Image">
                    {% endif %}
                  </td>
                  <td data-label="Name">{{ item.product_name }}</td>
                  <td data-label="Size">{{ item.size }}</td>
                  <td data-label="Qty">{{ item.quantity }}</td>
                  <td data-label="Price">${{ item.price }}</td>
                  <td data-label="Total">${{ item.total_price }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="empty-state">You have not placed any orders yet.</p>
    {% endif %}
  </div>
</div>

<script>
  // ✅ Tab Switching
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.target).classList.add('active');
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
